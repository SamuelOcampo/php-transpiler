require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var astNodes={},AST=function(parent){this._parent=parent,this._nodes=[]};AST.register=function(name,ctor){astNodes[name]=ctor},AST.extends=function(ctor){return ctor.prototype=new this,ctor.prototype.constructor=ctor,ctor.extends=this.extends.bind(ctor),ctor},AST.prototype.transpiler=function(){return this._parent instanceof AST?this._parent?this._parent.transpiler():void 0:this._parent},AST.prototype.create=function(name,options){if(!(name in astNodes))throw new Error("Undefined node "+name);return new astNodes[name](this,options);
},AST.prototype.append=function(name,options){var node=this.create(name,options);return this._nodes.push(node),node},AST.prototype.prepend=function(name,options){var node=this.create(name,options);return this._nodes.unshift(node),node},AST.prototype.variablesToString=function(indent){var buffer="";if(this.scope&&this.scope.variables)for(var n in this.scope.variables)"scope"===this.scope.variables[n].from&&(buffer+=indent+"var "+n+";\n");return buffer.length>0&&(buffer="\n"+indent+"// variables into current scope\n"+buffer),buffer},AST.prototype.toString=function(indent){for(var buffer="",i=0;i<this._nodes.length;i++)buffer+=this._nodes[i].toString(indent);return buffer},module.exports=AST},{}],2:[function(require,module,exports){"use strict";var Statement=require("./statement"),Assign=Statement.extends(function(parent,operator){Statement.apply(this,[parent]),this.operator=operator||"="});Assign.prototype.toString=function(indent){if(2===this._nodes.length){var buffer=this._nodes[0].toString(indent)+" "+this.operator+" "+this._nodes[1].toString(indent);
return this._parent instanceof Statement?buffer:indent+buffer+";\n"}throw new Error("Assign statement expects a left and right nodes")},module.exports=Assign},{"./statement":13}],3:[function(require,module,exports){"use strict";var Statement=require("./statement"),Bin=Statement.extends(function(parent,type){Statement.apply(this,[parent]),this.type=type||"+"});Bin.prototype.toString=function(indent){if(2===this._nodes.length){var buffer=this._nodes[0].toString(indent)+" "+this.type+" "+this._nodes[1].toString(indent);return this._parent instanceof Statement?buffer:indent+buffer+";\n"}throw new Error("Binary expression expects a left and right nodes")},module.exports=Bin},{"./statement":13}],4:[function(require,module,exports){"use strict";var AST=require("../ast"),Block=AST.extends(function(parent){AST.apply(this,[parent])});Block.prototype.toString=function(indent){return"{\n"+AST.prototype.toString.apply(this,[indent+"  "])+indent+"}\n"},module.exports=Block},{"../ast":1}],5:[function(require,module,exports){
"use strict";var Statement=require("./statement"),Call=Statement.extends(function(parent,what){Statement.apply(this,[parent]),this.what=what});Call.prototype.toString=function(indent){for(var args=[],i=0;i<this._nodes.length;i++)args.push(this._nodes[i].toString(indent));var buffer=this.what+" ("+args.join(", ")+")";return this._parent instanceof Statement?buffer:indent+buffer+"\n"},module.exports=Call},{"./statement":13}],6:[function(require,module,exports){"use strict";var AST=require("../ast"),Doc=AST.extends(function(parent,node){AST.apply(this,[parent]),this.node=node});Doc.prototype.toString=function(indent){if(this.node.isDoc){var body=this.node.lines.join("\n"+indent+" * ");return" * "===body.substring(body.length-3)&&(body=body.substring(0,body.length-3)),indent+"/** "+body+" */\n"}return indent+"// "+this.node.lines.join("\n"+indent+"// ")+"\n"},module.exports=Doc},{"../ast":1}],7:[function(require,module,exports){"use strict";var AST=require("../ast"),fn=AST.extends(function(parent,node){AST.apply(this,[parent]),
this.node=node});fn.prototype.checkArgumentType=function(nullable,name,type,indent,errTrigger){var checks=[];return nullable&&(checks.push(indent+"if("+name+" != null) {\n"),indent+="  "),"self"===type?checks.push(indent+"if(!("+name+" instanceof this))"+errTrigger):"array"===type?checks.push(indent+"if(!Array.isArray("+name+"))"+errTrigger):"callable"===type?checks.push(indent+"if(typeof "+name+" !== 'function')"+errTrigger):"bool"===type?checks.push(indent+"if(typeof "+name+" !== 'boolean' && !("+name+" instanceof Boolean))"+errTrigger):"float"===type?checks.push(indent+"if(typeof "+name+" !== 'number' || "+name+" % 1 === 0)"+errTrigger):"int"===type?checks.push(indent+"if(typeof "+name+" !== 'number' || "+name+" % 1 !== 0)"+errTrigger):"string"===type?checks.push(indent+"if(typeof "+name+" !== 'string' && !("+name+" instanceof String))"+errTrigger):checks.push(indent+"if(!"+name+".is('"+type+"'))"+errTrigger),nullable&&(indent=indent.substring(0,indent.length-2),checks.push(indent+"}\n")),checks},fn.prototype.toString=function(indent){
var buffer,name=this.node.name;"closure"===this.node.kind?(buffer="function (",name="#closure"):buffer="function "+name+" (";var parameters=[],checks=[];indent+="  ";for(var i=0;i<this.node.arguments.length;i++){var arg=this.node.arguments[i];parameters.push(arg.name),arg.variadic?(checks.push(indent+arg.name+" = Array.prototype.slice.call(arguments, "+i+");"),arg.type&&(checks.push(indent+"for(var $i = 0; $i < "+arg.name+".length; $i++) {\n"),checks=checks.concat(this.checkArgumentType(arg.nullable||arg.value&&"constref"===arg.value.kind&&"uqn"===arg.value.name.resolution&&"null"===arg.value.name.name,arg.name+"[$i]",arg.type,indent+"  "," $php.type_error("+i+", '"+arg.name+"', '"+name+"', '"+arg.type+"', "+arg.name+");")),checks.push(indent+"}"))):(arg.type&&(checks=checks.concat(this.checkArgumentType(arg.nullable||arg.value&&"constref"===arg.value.kind&&"uqn"===arg.value.name.resolution&&"null"===arg.value.name.name,arg.name,arg.type,indent," $php.type_error("+i+", '"+arg.name+"', '"+name+"', '"+arg.type+"', "+arg.name+");"))),
arg.value&&checks.push(indent+"if (typeof "+arg.name+" === 'undefined') "+arg.name+" = null;\n"))}return buffer+=parameters.join(", ")+") {\n",checks.length>0&&(buffer+=checks.join("\n")+"\n"),buffer+=this.variablesToString(indent),this.node.type?(buffer+=indent+"var $result = (function() {\n",buffer+=AST.prototype.toString.apply(this,[indent+"  "]),buffer+=indent+"})();\n",buffer+=this.checkArgumentType(this.node.nullable,"$result",this.node.type,indent," $php.type_error(-1, null, '"+name+"', '"+this.node.type+"', $result);").join("\n"),buffer+="\n"+indent+"return $result;\n"):buffer+=AST.prototype.toString.apply(this,[indent]),indent=indent.substring(0,indent.length-2),buffer+=indent+"}","function"===this.node.kind?buffer=indent+"$php.context.function.declare('"+this.node.name+"', "+buffer+");\n":"method"===this.node.kind||this._parent instanceof Statement||(buffer=indent+buffer+";\n"),buffer},module.exports=fn},{"../ast":1}],8:[function(require,module,exports){"use strict";var Statement=require("./statement"),If=Statement.extends(function(parent){
Statement.apply(this,[parent])});If.prototype.toString=function(indent){var buffer="if ("+this._nodes[0].toString(indent)+") "+this._nodes[1].toString(indent);return 3===this._nodes.length&&(buffer+=indent+"else "+this._nodes[2].toString(indent)),this._parent instanceof Statement?buffer:indent+buffer+"\n"},module.exports=If},{"./statement":13}],9:[function(require,module,exports){"use strict";var AST=require("../ast"),Namespace=AST.extends(function(parent,name){AST.apply(this,[parent]),this.name=name});Namespace.prototype.toString=function(indent){var buffer=indent+"$php.context.namespace.declare('"+this.name.replace(/\\/g,"\\\\")+"', function ($php) {\n";return buffer+=AST.prototype.toString.apply(this,[indent+"  "]),buffer+=indent+"}, $php);\n"},module.exports=Namespace},{"../ast":1}],10:[function(require,module,exports){"use strict";var AST=require("../ast"),Primitive=AST.extends(function(parent,node){AST.apply(this,[parent]),this.node=node});Primitive.prototype.toString=function(){if("string"===this.node.kind)return"'"+this.node.value.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/'/g,"\\'")+"'";
if("number"===this.node.kind)return this.node.value;if("boolean"===this.node.kind)return this.node.value?"true":"false";throw new Error("Undefined primitive type : "+this.node.kind)},module.exports=Primitive},{"../ast":1}],11:[function(require,module,exports){"use strict";var AST=require("../ast"),Program=AST.extends(function(parent){AST.apply(this,[parent])});Program.prototype.toString=function(indent){var buffer,isModule="module"===this.transpiler().mode;isModule?(buffer="/**\n * GLAYZZLE GENERATED FILE\n * @date "+(new Date).toString()+"\n * @see https://github.com/glayzzle/php-transpiler\n */\n",buffer+="module.exports = function($php) {\n",indent+="  "):buffer="";var fnBuffer="";for(var n in this.functions){var fn=this.functions[n];fnBuffer+=indent+"var "+fn.cb+" = $php.context.function.get('"+fn.name+"', "+(fn.lookup?"true":"false")+");\n"}return fnBuffer.length>0&&(buffer+=indent+"// function imports\n"+fnBuffer),buffer+=this.variablesToString(indent),buffer+=AST.prototype.toString.apply(this,[indent]),
isModule&&(buffer+="};\n"),buffer},module.exports=Program},{"../ast":1}],12:[function(require,module,exports){"use strict";var Statement=require("./statement"),AST=require("../ast"),Return=Statement.extends(function(parent){Statement.apply(this,[parent])});Return.prototype.toString=function(indent){var buffer="return ";return buffer+=AST.prototype.toString.apply(this,[indent]),this._parent instanceof Statement?buffer:indent+buffer+";\n"},module.exports=Return},{"../ast":1,"./statement":13}],13:[function(require,module,exports){"use strict";var AST=require("../ast"),Statement=AST.extends(function(parent){AST.apply(this,[parent])});Statement.prototype.toString=function(indent){for(var buffer="",i=0;i<this._nodes.length;i++)buffer+=indent+this._nodes[i].toString(indent)+";\n";return buffer},module.exports=Statement},{"../ast":1}],14:[function(require,module,exports){"use strict";var AST=require("../ast"),Unsupported=AST.extends(function(parent,node){AST.apply(this,[parent]),this.node=node});Unsupported.prototype.toString=function(indent){
return indent+'// Not supported "'+this.node.kind+'" at line '+this.node.loc.start.line+" \n"},module.exports=Unsupported},{"../ast":1}],15:[function(require,module,exports){"use strict";var AST=require("../ast"),Variable=AST.extends(function(parent,node){AST.apply(this,[parent]),this.node=node});Variable.prototype.toString=function(){if("string"==typeof this.node.name)return this.node.name;throw new Error("Dynamic variable names are not supported")},module.exports=Variable},{"../ast":1}],16:[function(require,module,exports){"use strict";var Scope=function(node){this.node=node,this.node.scope=this,this.variables={}};Scope.prototype.variable=function(name){return"string"==typeof name&&(name in this.variables||(this.variables[name]={from:"scope"})),this},module.exports=Scope},{}],17:[function(require,module,exports){"use strict";var Scope=require("./scope"),reservedTypes=["self","int","string","array","bool","float","callable"],State=function(){this.namespace="",this.uses={},this.scopes=[],this.functions={},this.classes={};
};State.prototype.getFunction=function(name){if(!(name in this.functions)){var lookup="?"===name[0];lookup&&(name=name.substring(1)),this.functions[name]={name:name,cb:"$fn_"+name.replace(/\\/g,"_"),lookup:lookup}}return this.functions[name].cb},State.prototype.addScope=function(node){var scope=new Scope(node);return this.scopes.push(scope),scope},State.prototype.popScope=function(){return this.scopes.pop()},State.prototype.scope=function(){return this.scopes[this.scopes.length-1]},State.prototype.resolve=function(identifier,asClass){if("rn"===identifier.resolution)return this.namespace+"\\"+identifier.name;if("fqn"===identifier.resolution)return identifier.name;if("uqn"===identifier.resolution)return identifier.name in this.uses?this.uses[identifier.name].name:reservedTypes.indexOf(identifier.name)>-1?identifier.name:asClass?this.namespace+"\\"+identifier.name:"?"+this.namespace+"\\"+identifier.name;var parts=identifier.name.split("\\"),prefix=parts.shift();return prefix in this.uses?this.uses[prefix]+"\\"+parts.join("\\"):this.namespace+"\\"+identifier.name;
},module.exports=State},{"./scope":16}],18:[function(require,module,exports){"use strict";module.exports=function(node,state,output){this.visit([node.left,node.right],state,output.append("assign",node.operator))}},{}],19:[function(require,module,exports){"use strict";module.exports=function(node,state,output){this.visit([node.left,node.right],state,output.append("bin",node.type))}},{}],20:[function(require,module,exports){"use strict";module.exports=function(node,state,output){var fnName=state.getFunction(state.resolve(node.what,!1));this.visit(node.arguments,state,output.append("call",fnName))}},{}],21:[function(require,module,exports){"use strict";module.exports=function(node,state,output){this.visit(node.arguments,state,output.append("statement").append("call","$php.stdout.print"))}},{}],22:[function(require,module,exports){"use strict";module.exports=function(node,state,output){var prevFn=state.function;state.function=node.name;for(var scope=state.addScope(output.append("function",node)),i=0;i<node.arguments.length;i++)scope.variables[node.arguments[i].name]={
from:"param"},node.arguments[i].type&&(node.arguments[i].type=state.resolve(node.arguments[i].type));if(node.uses&&node.uses.length>0)for(var i=0;i<node.uses.length;i++)scope.variables[node.uses[i].name]={from:"use"};node.type&&(node.type=state.resolve(node.type)),this.visit(node.body.children,state,scope.node),state.function=prevFn,state.popScope()}},{}],23:[function(require,module,exports){"use strict";module.exports=function(node,state,output){var properties=[];for(var k in node)(Array.isArray(node[k])||node[k].kind)&&properties.push(node[k]);this.visit(properties,state,output.append(node.kind,node))}},{}],24:[function(require,module,exports){"use strict";module.exports=function(node,state,output){var ifNode=output.append("if");this.visit([node.test,node.body],state,ifNode),node.alternate&&this.visit(node.alternate,state,ifNode)}},{}],25:[function(require,module,exports){"use strict";module.exports=function(node,state,output){var previousNamespace=state.namespace;state.namespace=node.name.name,this.visit(node.children,state,output.append("namespace",node.name.name)),
state.namespace=previousNamespace}},{}],26:[function(require,module,exports){"use strict";module.exports=function(node,state,output){output.append("primitive",node)}},{}],27:[function(require,module,exports){"use strict";module.exports=function(node,state,output){var main=state.addScope(output.append("program")).node;this.visit(node.children,state,main),main.functions=state.functions,main.classes=state.classes}},{}],28:[function(require,module,exports){"use strict";module.exports=function(node,state,output){this.visit(node.expr,state,output.append("return"))}},{}],29:[function(require,module,exports){"use strict";module.exports=function(node,state,output){state.scope().variable(node.name),output.append("variable",node)}},{}],"php-transpiler":[function(require,module,exports){"use strict";var AST=require("./ast"),State=require("./state"),Visitors={program:require("./visitor/program"),namespace:require("./visitor/namespace"),echo:require("./visitor/echo"),print:require("./visitor/echo"),string:require("./visitor/primitive"),
number:require("./visitor/primitive"),boolean:require("./visitor/primitive"),assign:require("./visitor/assign"),variable:require("./visitor/variable"),bin:require("./visitor/bin"),function:require("./visitor/function"),closure:require("./visitor/function"),method:require("./visitor/function"),return:require("./visitor/return"),doc:require("./visitor/generic"),if:require("./visitor/if"),block:require("./visitor/generic"),call:require("./visitor/call")},Transpiler=function(options){if(this.visitors={},this.mode="module",options)for(var k in options)this[k]=options};Transpiler.prototype.generate=function(ast){var output=new AST(this),state=new State;return this.visit(ast,state,output),output.toString("")},Transpiler.generate=function(ast,options){return new Transpiler(options).generate(ast)},Transpiler.prototype.visit=function(node,state,output){if(Array.isArray(node))for(var i=0;i<node.length;i++)this.visit(node[i],state,output);else{var fn=node.kind in this.visitors?this.visitors[node.kind]:Visitors[node.kind];"function"==typeof fn?fn.apply(this,[node,state,output]):output.append("unsupported",node);
}},AST.register("program",require("./ast/program")),AST.register("namespace",require("./ast/namespace")),AST.register("primitive",require("./ast/primitive")),AST.register("statement",require("./ast/statement")),AST.register("call",require("./ast/call")),AST.register("assign",require("./ast/assign")),AST.register("variable",require("./ast/variable")),AST.register("bin",require("./ast/bin")),AST.register("function",require("./ast/function")),AST.register("unsupported",require("./ast/unsupported")),AST.register("return",require("./ast/return")),AST.register("doc",require("./ast/doc")),AST.register("if",require("./ast/if")),AST.register("block",require("./ast/block")),module.exports=Transpiler},{"./ast":1,"./ast/assign":2,"./ast/bin":3,"./ast/block":4,"./ast/call":5,"./ast/doc":6,"./ast/function":7,"./ast/if":8,"./ast/namespace":9,"./ast/primitive":10,"./ast/program":11,"./ast/return":12,"./ast/statement":13,"./ast/unsupported":14,"./ast/variable":15,"./state":17,"./visitor/assign":18,"./visitor/bin":19,"./visitor/call":20,
"./visitor/echo":21,"./visitor/function":22,"./visitor/generic":23,"./visitor/if":24,"./visitor/namespace":25,"./visitor/primitive":26,"./visitor/program":27,"./visitor/return":28,"./visitor/variable":29}]},{},[]);
//# sourceMappingURL=php-transpiler.min.js.map